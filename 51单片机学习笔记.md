# 51单片机学习笔记

电磁阀
气缸
位置感应器
测试

## Lesson_1

1.单片机型号信息：
      -------------------------------------
      STC 89C52RC
      40C-PDIP
      0721CV4336...
      -------------------------------------
      STC：公司名
      89：系列名
      C：CMOS器件
      52：还有51、54、55、58、516
      5后面的数表示内部程序存储空间的大小
      40：表示单片机所能支持的晶振频率为40MHz
      C：代表商业及，I代表工业级
      PDIP：表示封装方式（双列直插式）
      0721：07年第21周生产        后面是批号生产号等

2.总线型和非总线型
      总线型：P1.0 ~ P1.7
      P2.0 ~ P2.7
      P3.0 ~ P3.7
      ......
      非总线型： 缺P口

3.P3引脚的第二功能定义：
      P3.0：RXD串行口输入
      P3.1：TXD串行口输出
      P3.2：INT0（低电平有效（上划线））外部中断0输入
      P3.3: INT1（低电平有效（上划线））外部中断1输入
      P3.4：T0定时器0外部输入
      P3.5：T1定时器1外部输入
      P3.6：WR（低电平有效（上划线））外部写控制
      P3.7：RD（低电平有效（上划线））外部读控制

4. C51的数据类型扩展定义：
   sfr:特殊功能寄存器声明
   sfr16:sfr的16位数据声明
   sbit:特殊功能位声明
   bit:位变量声明

5. C51头文件
  通常有：reg51.h	reg52.h	math.h	ctype.h	stdio.h	stdlib.h	absacc.h

6. 运算符
  ">>"(位右移)
  右移后，最右边的溢出，不够的补零

7. 中断服务程序
```
函数名()	interrupt  n  using  m
  {
  //函数内部实现
  }
```

8. 最小系统
电源、晶振、复位电路

9. Keil软件的使用

10. 硬件材料
DIP40脚座、杜邦线（单头带帽40根）、单排针（2排）、小电路板、DS12C887（时钟晶振芯片）、焊接

11.二极管压降5V
<img src="https://github.com/ErenChris/ErenChris_Blogs/blob/8d10b4a2617149a91a7c9e3427a23578295bffe6/images/%E4%BA%8C%E6%9E%81%E7%AE%A1%E5%8E%8B%E9%99%8D.png"/>

12.电平特性
课程中定义为TTL电平：
高+5V、低0V
RS232电平：计算机串口
高-12V、低+12V
所以计算机和单片机通讯通常要加电平转换芯片max232

13. 引脚上方的横线代表低电平有效

14. Z是高阻态，Q0上一次的值

15. 74HC573 锁存

16.（重要）所有的51单片机上电后都默认高电平

17. I/O口从高到低

18. D2 = P1^2 ----> 符号“^”代表第几位



## Lesson_2

1. Keil软件中的<img src="https://github.com/ErenChris/ErenChris_Blogs/blob/main/images/Keil%E8%B0%83%E8%AF%95%E6%A0%87%E5%BF%97.png"/>代表调试模式

2. 基本时序
（1）震荡周期：晶振：11.0592mHz
（2）状态周期：为时钟周期（就是振荡周期）的2倍
（3）机器周期：一个机器周期包含6个状态周期S1~S6，也就是12个时钟周期
（4）指令周期：完成一条操作所需要的时间

3.在调试界面的左侧系统寄存器里的sec值可以看到程序运行的时间（微调时间）

4.宏定义
**#define uint unsigned int**
用uint代替unsigned int

5. 调用子程序（调用函数）
延时子程序（无返回值无参数）：
```C#
void delay()
{
uint x,y;
for(x=100;x>0;x--)
{
......
}
}
```
6. 带参子函数

7. C语言库函数调用
在keil文件下C51----> help 中有开发帮助文档

8. 蜂鸣器继电器的驱动


## Lesson_3

1. 端口存在第二功能需要在寄存器中设置

2.	RST/VPD紧急供电
P3.0/RXD: 串行输入口
P3.1/TXD：串行输出口
P3.2/INT0：中断
P3.3/INT1：中断
P3.4/T0 & P3.5/T1：定时器/计数器
P3.6/WR(上横线) & P3.7/RD(上横线)：外部数据存储器的写选通读选通

3. XTAL2 & XTAL1：晶振输入端

4. P0口是有三态状态的：高电平、低电平、高阻态

5. 共阴极、共阳极数码管

6. P0口要加上拉电阻

7.段选和位选
位选是指启用哪一个数码管
段选是指让数码管点亮哪一些位置而形成相应的数字显示

8. P0口是三态口，要加上拉电阻10k电阻

9. 74HC573锁存器
DULA为高时，直通
为低时，保持之前的状态

10. 锁存器的锁存端可以控制锁存器（唯一的控制引脚）

11. 编码表
unsigned char code table[]=
code关键字表示将数据放入堆中，不占用栈的内存

12. 中断系统
80C51有五个中断源
80C52有六个中断源
两个优先级可实现二级中断嵌套

14. 中断请求标志
* TCON的中断标志
* SCON的中断标志
* 优先级

14. 中断响应条件
（1）中断源有中断请求
（2）此中断源的中断允许位为1
（3）CPU开中断（即EA=1）

15. 
```
void 函数名() interrupt 0
{

}
```
interrupt是中断声明

中断函数不需要声明

16. 定时器/计数器
TMOD是工作方式寄存器
TCON是控制寄存器

当设置定时器的模式时，加1计数器，对内部机器周期计数（一个机器周期等于12个振荡周期，即计数频率为晶振频率的）
计数值N乘以机器周期Tcy就是定时时间T

**设置为计数器的情况后面讲**

计数个数与计数初值的关系为： X（初值）= 216 -N（个数）		（方式一状态下）

## Lesson_4

1. #include<intruns.h>

2. 动态显示数码管只需要看懂一个程序--->[动态显示数码管程序网址](https://wenku.baidu.com/view/f7433658aef8941ea76e05e3.html#)